<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Matisov X ‚Äî The Great Expansion</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Rajdhani:wght@300;500;700&display=swap');

        :root {
            --neon-blue: #00d2ff;
            --neon-pink: #ff007a;
            --glass-core: rgba(5, 10, 20, 0.95);
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; user-select: none; touch-action: none; margin: 0; padding: 0; }
        body { background-color: #000; color: #fff; font-family: 'Rajdhani', sans-serif; overflow: hidden; height: 100vh; width: 100vw; }

        #matisov-bg-engine {
            position: fixed; inset: 0;
            background: url('https://raw.githubusercontent.com/matisovx-ship-it/Matisov-X-beta/main/1771154757483~2.png') no-repeat center center;
            background-size: cover; filter: brightness(0.4) contrast(1.2); z-index: -1;
        }

        .cyber-glass {
            background: var(--glass-core); backdrop-filter: blur(25px);
            border: 1px solid rgba(0, 210, 255, 0.15); border-radius: 24px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.8);
        }

        #hero-combat-zone { transition: transform 0.06s cubic-bezier(0.175, 0.885, 0.32, 1.275); will-change: transform; }
        
        .mx-coin-particle {
            position: absolute; pointer-events: none; z-index: 1000;
            font-family: 'Orbitron', sans-serif; font-weight: 900; color: var(--neon-blue);
            text-shadow: 0 0 20px var(--neon-blue); display: flex; flex-direction: column; align-items: center;
        }

        .game-screen {
            position: fixed; inset: 0; z-index: 2000; background: radial-gradient(circle at center, #0a0e14 0%, #000 100%);
            display: none; flex-direction: column; padding: 25px; padding-bottom: 160px; overflow-y: auto;
        }
        .screen-visible { display: flex !important; animation: screenFade 0.4s ease-out; }

        @keyframes screenFade { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        .bottom-nav-hub { position: fixed; bottom: 35px; left: 20px; right: 20px; z-index: 5000; }
        .nav-trigger { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 6px; color: #4a5568; transition: 0.3s; }
        .nav-active { color: var(--neon-blue); filter: drop-shadow(0 0 8px var(--neon-blue)); transform: translateY(-5px); }

        .energy-wrapper { height: 12px; background: #000; border-radius: 20px; border: 1px solid rgba(0, 210, 255, 0.3); }
        .energy-fluid { height: 100%; border-radius: 20px; background: linear-gradient(90deg, #00d2ff, #3a7bd5); box-shadow: 0 0 15px var(--neon-blue); transition: width 0.4s; }
        
        .burn-action-btn { background: linear-gradient(135deg, #ff007a 0%, #7a00ff 100%); border-radius: 18px; position: relative; overflow: hidden; }
        .mission-row { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); padding: 18px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div id="matisov-bg-engine"></div>

    <div id="game-interface-root" class="flex flex-col h-screen p-6 relative">
        <header class="flex justify-between items-start mb-8 z-[100]">
            <div class="space-y-2">
                <h1 class="text-3xl font-black italic tracking-tighter">MATISOV <span class="text-cyan-400">X</span></h1>
                <div class="cyber-glass px-4 py-2 flex items-center gap-3 border-l-4 border-pink-500">
                    <div class="w-2 h-2 bg-pink-500 rounded-full animate-pulse"></div>
                    <span id="ai-neural-text" class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Neural Link: Ready</span>
                </div>
            </div>
            <div class="text-right cyber-glass p-4 min-w-[120px]">
                <div id="mx-balance-display" class="text-3xl font-black italic mb-1">0</div>
                <div class="text-[10px] text-cyan-500 font-black uppercase tracking-tighter">MX Tokens</div>
            </div>
        </header>

        <main class="flex-grow flex items-center justify-center relative" id="combat-click-trigger">
            <div id="hero-combat-zone" class="w-full max-w-[300px]">
                <img src="https://raw.githubusercontent.com/matisovx-ship-it/Matisov-X-beta/main/file_00000000f6b4720a8cb3d5825edd6728_011655.png" alt="Hero">
            </div>
        </main>

        <div class="mb-32 z-[100]">
            <div class="flex justify-between items-end text-[11px] font-black mb-2 tracking-widest">
                <div>‚ö° ENERGY: <span id="energy-numeric" class="text-white text-sm">1000/1000</span></div>
            </div>
            <div class="energy-wrapper"><div id="energy-fluid-fill" class="energy-fluid" style="width: 100%"></div></div>
        </div>

        <div class="bottom-nav-hub">
            <nav class="nav-inner cyber-glass flex justify-around p-3">
                <button onclick="switchSystemScreen('battle')" id="btn-nav-battle" class="nav-trigger nav-active"><span>‚öîÔ∏è</span><span class="text-[9px]">–ë–Ü–ô</span></button>
                <button onclick="switchSystemScreen('missions')" id="btn-nav-missions" class="nav-trigger"><span>üìú</span><span class="text-[9px]">–ú–Ü–°–Ü–á</span></button>
                <button onclick="switchSystemScreen('burning')" id="btn-nav-burning" class="nav-trigger"><span>üî•</span><span class="text-[9px]">–ë–£–°–¢</span></button>
                <button onclick="switchSystemScreen('commander')" id="btn-nav-commander" class="nav-trigger"><span>üë§</span><span class="text-[9px]">–ü–†–û–§–Ü–õ–¨</span></button>
            </nav>
        </div>
    </div>

    <div id="screen-missions" class="game-screen">
        <h2 class="text-3xl font-black italic text-yellow-500 mb-8 uppercase">Neural Tasks</h2>
        <div id="missions-render-list"></div>
    </div>

    <div id="screen-burning" class="game-screen text-center">
        <h2 class="text-3xl font-black italic text-pink-500 mb-8 uppercase">Burning Lab</h2>
        <div class="cyber-glass p-8 mb-8 border-t-4 border-pink-500">
            <div class="text-6xl mb-4">üî•</div>
            <h3 class="text-xl font-bold mb-4 uppercase">Overclock Neural Link</h3>
            <button onclick="executeBurningUpgrade()" class="burn-action-btn w-full py-6 font-black uppercase shadow-2xl">
                Burn 500,000 MX<br><span class="text-xs opacity-80">+2.5 Power</span>
            </button>
        </div>
        <div class="grid grid-cols-2 gap-4">
            <div class="cyber-glass p-4 text-xs text-gray-400">POWER: <span id="stats-current-power" class="text-white">1.0</span></div>
            <div class="cyber-glass p-4 text-xs text-gray-400">BURNED: <span id="stats-burned-total" class="text-white">0</span></div>
        </div>
    </div>

    <div id="screen-commander" class="game-screen text-center">
        <h2 class="text-3xl font-black italic text-cyan-400 mb-8 uppercase">Commander</h2>
        <div id="ton-connect-mount-point" class="mb-6 flex justify-center"></div>
        <div class="cyber-glass p-6 mb-6">
            <img id="p-commander-avatar" src="" class="w-20 h-20 rounded-full mx-auto border-2 border-cyan-400 p-1 mb-3">
            <h3 id="p-commander-name" class="text-xl font-black">---</h3>
            <p id="p-commander-wallet" class="text-[10px] text-gray-500 font-mono truncate px-4">Wallet: Not Connected</p>
        </div>
        <div class="cyber-glass p-6 text-left">
            <h4 class="text-[10px] font-black text-pink-500 uppercase mb-2">Referral Link</h4>
            <div id="ref-link-display" class="bg-black/40 p-3 rounded-lg text-[9px] text-cyan-300 break-all mb-4">---</div>
            <button onclick="copyRefToClipboard()" class="w-full py-3 bg-white text-black font-black rounded-lg text-xs uppercase">–ö–æ–ø—ñ—é–≤–∞—Ç–∏ (+50k Bonus)</button>
        </div>
    </div>
    <script>
    const tg = window.Telegram.WebApp;
    // –¢–ó: –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –ø—Ä–µ—Ñ—ñ–∫—Å –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    const UID = tg.initDataUnsafe?.user?.id || "local_dev";
    const USER_NAME = tg.initDataUnsafe?.user?.first_name || "Samurai";
    
    // –§—É–Ω–∫—Ü—ñ—è-—Ö–µ–ª–ø–µ—Ä –¥–ª—è —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∫–ª—é—á—ñ–≤
    const storageKey = (key) => `mx_${UID}_${key}`;

    // –°—Ç–∞–Ω –≥—Ä–∏ (–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ localStorage)
    let state = {
        balance: parseFloat(localStorage.getItem(storageKey('bal'))) || 0,
        energy: parseInt(localStorage.getItem(storageKey('ene'))) || 1000,
        power: parseFloat(localStorage.getItem(storageKey('pwr'))) || 1.0,
        burnedTotal: parseFloat(localStorage.getItem(storageKey('burned'))) || 0,
        tasksDone: JSON.parse(localStorage.getItem(storageKey('tasks'))) || [],
        refClaimed: localStorage.getItem(storageKey('ref_claimed')) === 'true',
        maxEnergy: 1000
    };

    const tonConnectUI = new TONConnectUI.TonConnectUI({
        manifestUrl: 'https://raw.githubusercontent.com/matisovx-ship-it/Matisov-X-beta/main/manifest.json',
        buttonRootId: 'ton-connect-mount-point'
    });

    function initNeuralCore() {
        tg.expand();
        tg.ready();

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ—Ñ—ñ–ª—é
        document.getElementById('p-commander-name').innerText = USER_NAME.toUpperCase();
        document.getElementById('ref-link-display').innerText = `https://t.me/Matisov_X_bot?start=${UID}`;
        
        const photo = tg.initDataUnsafe?.user?.photo_url;
        document.getElementById('p-commander-avatar').src = photo || 'https://raw.githubusercontent.com/matisovx-ship-it/Matisov-X-beta/main/file_00000000f6b4720a8cb3d5825edd6728_011655.png';

        // –¢–ó: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å—É
        checkReferralBonus();

        updateVisualStats();
        startRegeneration();
    }

    // –¢–ó: –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –≤ localStorage
    function saveGameState() {
        localStorage.setItem(storageKey('bal'), state.balance);
        localStorage.setItem(storageKey('ene'), state.energy);
        localStorage.setItem(storageKey('pwr'), state.power);
        localStorage.setItem(storageKey('burned'), state.burnedTotal);
        localStorage.setItem(storageKey('tasks'), JSON.stringify(state.tasksDone));
    }

    function updateVisualStats() {
        document.getElementById('mx-balance-display').innerText = Math.floor(state.balance).toLocaleString();
        document.getElementById('energy-numeric').innerText = `${state.energy}/${state.maxEnergy}`;
        document.getElementById('energy-fluid-fill').style.width = `${(state.energy / state.maxEnergy) * 100}%`;
        document.getElementById('stats-current-power').innerText = state.power.toFixed(1);
        document.getElementById('stats-burned-total').innerText = Math.floor(state.burnedTotal).toLocaleString();
    }
    </script>
<script>
    // –¢–ó: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è (–ë–æ–Ω—É—Å 50,000 MX)
    function checkReferralBonus() {
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä start_param –≤—ñ–¥ Telegram
        const startParam = tg.initDataUnsafe?.start_param;
        
        if (startParam && !state.refClaimed) {
            state.balance += 50000;
            state.refClaimed = true;
            localStorage.setItem(storageKey('ref_claimed'), 'true');
            saveGameState();
            tg.showAlert("ü§ñ Neural System: –í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –±–æ–Ω—É—Å 50,000 MX –∑–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è!");
        }
    }

    // –û–±—Ä–æ–±–∫–∞ —Ç–∞–ø—É
    document.getElementById('combat-click-trigger').addEventListener('pointerdown', (e) => {
        if (state.energy < 1) {
            tg.HapticFeedback.notificationOccurred('warning');
            return;
        }

        state.balance += state.power;
        state.energy -= 1;

        // –ê–Ω—ñ–º–∞—Ü—ñ—è –≥–µ—Ä–æ—è
        const hero = document.getElementById('hero-combat-zone');
        hero.style.transform = 'scale(0.95)';
        setTimeout(() => hero.style.transform = 'scale(1)', 50);

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ–Ω–µ—Ç–∫–∏
        const p = document.createElement('div');
        p.className = 'mx-coin-particle';
        p.style.left = `${e.clientX}px`; p.style.top = `${e.clientY}px`;
        p.innerHTML = `ü™ô +${state.power.toFixed(1)}`;
        document.body.appendChild(p);
        gsap.to(p, { y: -120, opacity: 0, duration: 0.6, onComplete: () => p.remove() });

        tg.HapticFeedback.impactOccurred('medium');
        updateVisualStats();
        saveGameState();
    });

    function startRegeneration() {
        setInterval(() => {
            if (state.energy < state.maxEnergy) {
                state.energy = Math.min(state.maxEnergy, state.energy + 5);
                updateVisualStats();
                saveGameState();
            }
        }, 1500);
    }

    function switchSystemScreen(screenId) {
        document.querySelectorAll('.game-screen').forEach(s => s.classList.remove('screen-visible'));
        document.querySelectorAll('.nav-trigger').forEach(n => n.classList.remove('nav-active'));
        if (screenId !== 'battle') document.getElementById(`screen-${screenId}`).classList.add('screen-visible');
        document.getElementById(`btn-nav-${screenId}`).classList.add('nav-active');
        tg.HapticFeedback.impactOccurred('light');
    }

    function executeBurningUpgrade() {
        const cost = 500000;
        if (state.balance >= cost) {
            state.balance -= cost;
            state.power += 2.5;
            state.burnedTotal += cost;
            saveGameState();
            updateVisualStats();
            tg.showAlert("üî• –°–∏—Å—Ç–µ–º–∞ –æ–Ω–æ–≤–ª–µ–Ω–∞! –°–∏–ª–∞ —Ç–∞–ø—É –∑—Ä–æ—Å–ª–∞.");
        } else {
            tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ MX –¥–ª—è —Å–ø–∞–ª—é–≤–∞–Ω–Ω—è.");
        }
    }

    function copyRefToClipboard() {
        const link = `https://t.me/Matisov_X_bot?start=${UID}`;
        const i = document.createElement('input'); i.value = link; document.body.appendChild(i); i.select(); document.execCommand('copy'); document.body.removeChild(i);
        tg.showAlert("–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!");
    }

    window.addEventListener('DOMContentLoaded', initNeuralCore);
</script>
</body>
</html>
